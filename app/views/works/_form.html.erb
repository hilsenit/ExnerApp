<div class="row">
<div class="large-10 large-offset-1 medium-10 medium-offset-1 columns">
<h2 class="text-center">Opret Værk</h2>

		<%# form_for(@work, :html => { :multipart => true }, url: works_path) do |f| %>
		<%= form_for(@work, :html => { :multipart => true }) do |f| %>

		<%= f.label "Navn:" %>
		<%= f.text_field :name %>

		<%= f.label "Sagsnr:" %>
		<%= f.number_field :sagsnr %>

		<%= f.label "Adresse:" %>
		<%= f.text_field :address %>
		
		<%= f.label :info, "Info" %>
		<small>De linjer, der står under adresse og sagsnr i info f.eks. konkurrence, samarbejde mm.</small>

		<div class="info-area">

		<% @work.info.each_with_index do |information, index| %>
	
			<div class="info-felt row collapse" id="InfoFelt">

				<% if index != 0 %>
				<div class="info-area-field small-9 columns">
				<%= f.text_field :info, multiple: true, value: i, id: "InfoArea" %>
				</div>
				
					<div class="button delete-info-button small-3 columns" id="DeleteInfo">
					Slet felt
					
				</div>
					
				<% else %>
				<div class="small-12 columns">
					<%= f.text_field :info, multiple: true, value: information, id: "InfoArea", class: "info-area-field small-12 columns" %>
				</div>
				<% end %>

			
			</div>

		<% end %>

		</div>

		<div class="button" id="AddInfo">Tilføj et info-felt mere</div>

		<%= f.label :description, "Beskrivelse" %>
		<%= f.text_area :description, height: 400 %>


		<div class="large-12 column background-color-light-blue">
		<%= f.fields_for :image_categories do |img_cat| %>

			<h3 class="text-center">Navn på billedekategorien</h3>
				<%= img_cat.text_field :name %>

		

		<%= img_cat.fields_for :images do |img| %>

		<div class="large-12 column image-area">
			<div class="small-4 column image-box float-left">

			<%= img.label :image, "Billede "%>
			<%= img.file_field :image %>

			<% if img.object.image? %>
				<%= image_tag img.object.image.thumb.url %>
			<% end %>

			<%= img.label :image_description, "Billedebeskrivelse" %>
			<%= img.text_area :image_description %>

			<%= img.label :photographer, "Fotograf" %>
			<%= img.text_field :photographer %>
			<div class="button delete-info-button small-12 columns" id="DeleteImage">
				Slet billede
			</div>
			</div>
		</div>	
		<% end %> <!-- img -->

		</div>
		<div style="margin-bottom: 100px;" class="button add-new-image large-3" id="AddImage">Opret nyt billede</div> 
		
		<% end %> <!-- img_cat -->

		<div class="actions small-12 columns">
			<%= f.submit "Gem værk", class: "button primary" %>
		</div>
		<% end %> <!-- form -->
	</div>
</div>

<script type="text/javascript">
// Tilføj og fjern info
	$('#AddInfo').on('click', function(e) {
	e.preventDefault();
	// Fjern dataen i inputfeltet
	$(".info-area").append('<div class="info-felt row collapse" id="InfoFelt"><div class="small-9 columns"><input multiple="multiple" value="" id="InfoArea" class="info-area-field small-9 columns" type="text" name="work[info][]"></div><div class="button delete-info-button small-3 columns" id="DeleteInfo">Slet felt</div></div>');
	});

	$('body').on('click', '.delete-info-button', function(e) {
		e.preventDefault();
		$(this).closest("#InfoFelt").remove();
	});

// Udskifter data, når man trykker "nyt billede"
 	function change_input_data(div, number, after_this_div="", add_box_after=false) {
// Tilføjer det add_image felt, som skal til. 
	  $(div).find('label').each(function() {
	  	$(this).val("");
	    oldLabel = $(this).attr('for');
	    newLabel = oldLabel.replace(new RegExp(/_[0-9]+(?!.*[0-9])_/), "_" + number + "_");
	    $(this).attr('for', newLabel);

	  $(div).find('textarea, input').each(function() {
	  	$(this).val("");
	    oldId = $(this).attr('id');
	    newId = oldId.replace(new RegExp(/_[0-9]+(?!.*[0-9])_/), "_" + number + "_");
	    $(this).attr('id', newId);
	    
	    oldName = $(this).attr('name');
	    newName = oldName.replace(new RegExp(/\[[0-9]+\](?!.*\[[0-9]\])/), "[" + number + "]");
	    // newName = oldName.replace(new RegExp(/\[[0-9]+\]/), "[" + number + "]");
	    // newName = oldName.replace(new RegExp(/\[[0-9]+\]/), "[" + number + "]");
	    $(this).attr('name', newName);

	    	
	  
	});

	});
	    if (add_box_after == true) {
	    	// Fjern src værdien fra img
	    	$(div).find('img').each(function() {
	    		$(this).hide();
	    	});
  			$( div ).insertAfter( after_this_div );
  		}
}

$("body").on("click", "#DeleteImage", function(e){
	e.preventDefault();
	$(this).parent().remove();
	$(".image-box").each(function(index) {
		  change_input_data(this, index);
	});
})

$('#AddImage').click(function(e) {
  e.preventDefault();
  this_image_category = $(this).closest('.image-box');
  // Dette gør sådan at man kan tilføje en billede boks
  lastNestedForm = $('.image-box').last();
  newNestedForm  = lastNestedForm.clone();
  // newNestedForm  = this_div;

  formsOnPage    = $('.image-box').length;

  change_input_data(newNestedForm, formsOnPage, lastNestedForm, true)
});


</script>