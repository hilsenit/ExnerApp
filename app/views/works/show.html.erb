<%= javascript_include_tag "html.sortable", 'data-turbolinks-track' => true if logged_in?(:site_admin) %>
<%= javascript_include_tag "work_images", 'data-turbolinks-track' => true if logged_in?(:site_admin) %>

<%= logged_in_work_helper if logged_in?(:site_admin) %>

<!-- LARGE IMAGE --> 
<div class="large-image">
	<%= render partial: "large_image", locals: {url: @first_image.image.url, description: @first_image.image_description, photographer: @first_image.photographer} %></%>
</div>
<div class="col-lg-12 hide-it info-field-work">
	<h2>Information</h2>
	<div class="info-kort">
	<%= content_tag :p, info_helper(@work).html_safe if info_helper @work %> 
	</div>
	<div class="info-beskrivelse">
		<%= simple_format(@work.description) if @work.description %>
	</div>
</div>

<%= link_to "GÃ¥ tilbage til #{@work.category.name}", vaerker_path(@work.category.friendly_id), class: "btn btn-secondary" %>
<!-- IMG CAT NAVBAR -->
<div class="img-nav-bar img-cat-nav-inner sortable-images">
	<%= content_tag :span, "Info", class: "info-button"	unless info_helper(@work).nil? && @work.description.empty? %>
	<%= render partial: "img_cat_nav", locals: {img_cats: @image_categories} %> 
</div>

<!-- THUMB IMAGES -->
<div class="thumb-images row sortable-images">
	<%= render partial: "thumb_images", locals: {images: @image_categories.first.images, work_id_friendly: @work.friendly_id} %>
</div>


<script type="text/javascript">

	$(document).ready(function() {
		// Also used in works/js/new_image.js.erb - fade-in effect
		photo_desc = 
		"<%=j render partial: "image_info", locals: {description: @first_image.image_description, photographer: @first_image.photographer} %>"

		function loadImage(image_url, photo_desc) {
			var img = new Image();
			$(img).load(function() {
				$(".image-desc-wrapper").html(img).append(photo_desc);
				$(img).fadeIn(300);
			}).attr({src: image_url, id: "largeImage"});
		}

		loadImage('<%= @first_image.image.url %>', photo_desc);


		$("body").on("click", ".thumb-image", function() {
			addActiveClass($(this), 'thumbnail-active');
			image_id = $(this).data("id");
			changeLargeImage(image_id);

		});

		$(".info-button").on("click", function() {
			$(this).toggleClass("info-button-active");
			$(".info-field-work").slideToggle("fast");
		});

		function addActiveClass(active_object, active_class) {
			active_object.addClass(active_class).siblings().removeClass(active_class);
		}
		function changeLargeImage(image_id) {

			$.ajax({
				url: '/works/' + image_id + '/new_image',
				cache: false,
				type: 'GET',
				data: {id: image_id},
				beforeSend: function() {
					$(".image-info").hide();
					$("#largeImage").hide(); // To show loading icon
				}
			}); 			
		
		}

	});

</script>
